(function(){var t,e,r,n,i,o,s,a,u,h,l={}.hasOwnProperty,p=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1},c=function(t,e){function r(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};if(h=function(){function t(){throw new Error("Not implemented. Did you mean to use Dropbox.Client?")}return t}(),h.Util=function(){function t(){}return t}(),h.Http=function(){function t(){}return t}(),h.File=function(){function t(){}return t}(),"undefined"!=typeof global&&"undefined"!=typeof module&&"exports"in module)e=global,module.exports=h;else if("undefined"!=typeof window&&"undefined"!=typeof navigator)e=window,window.Dropbox&&!function(){var t,e,r,n;e=window.Dropbox,r=[];for(t in e)l.call(e,t)&&(n=e[t],r.push(h[t]=n));return r}(),window.Dropbox=h;else{if("undefined"==typeof self||"undefined"==typeof navigator)throw new Error("dropbox.js loaded in an unsupported JavaScript environment.");e=self,self.Dropbox=h}if(h.Env=function(){function t(){}return t.global=e,t}(),h.Util.EventSource=function(){function t(t){this._cancelable=t&&t.cancelable,this._listeners=[]}return t.prototype.addListener=function(t){if("function"!=typeof t)throw new TypeError("Invalid listener type; expected function");return p.call(this._listeners,t)<0&&this._listeners.push(t),this},t.prototype.removeListener=function(t){var e,r,n,i,o,s;if(this._listeners.indexOf)r=this._listeners.indexOf(t),-1!==r&&this._listeners.splice(r,1);else for(o=this._listeners,e=n=0,i=o.length;i>n;e=++n)if(s=o[e],s===t){this._listeners.splice(e,1);break}return this},t.prototype.dispatch=function(t){var e,r,n,i,o;for(i=this._listeners,e=0,r=i.length;r>e;e++)if(n=i[e],o=n(t),this._cancelable&&o===!1)return!1;return!0},t}(),h.AccountInfo=function(){function t(t){var e;this._json=t,this.name=t.display_name,this.email=t.email,this.countryCode=t.country||null,this.uid=t.uid.toString(),t.public_app_url?(this.publicAppUrl=t.public_app_url,e=this.publicAppUrl.length-1,e>=0&&"/"===this.publicAppUrl.substring(e)&&(this.publicAppUrl=this.publicAppUrl.substring(0,e))):this.publicAppUrl=null,this.referralUrl=t.referral_link,this.quota=t.quota_info.quota,this.privateBytes=t.quota_info.normal||0,this.sharedBytes=t.quota_info.shared||0,this.usedQuota=this.privateBytes+this.sharedBytes}return t.parse=function(t){return t&&"object"==typeof t?new h.AccountInfo(t):t},t.prototype.name=null,t.prototype.email=null,t.prototype.countryCode=null,t.prototype.uid=null,t.prototype.referralUrl=null,t.prototype.publicAppUrl=null,t.prototype.quota=null,t.prototype.usedQuota=null,t.prototype.privateBytes=null,t.prototype.sharedBytes=null,t.prototype.json=function(){return this._json},t}(),h.ApiError=function(){function t(t,e,r){var n,i,o,s,a,u;if(this.method=e,this.url=r,this.status=t.status,t.responseType)try{a=t.response||t.responseText}catch(n){u=n;try{a=t.responseText}catch(i){u=i,a=null}}else try{a=t.responseText}catch(o){u=o,a=null}if(a)try{this.responseText=a.toString(),this.response=JSON.parse(a)}catch(s){u=s,this.response=null}else this.responseText="(no response)",this.response=null}return t.prototype.status=null,t.prototype.method=null,t.prototype.url=null,t.prototype.responseText=null,t.prototype.response=null,t.NETWORK_ERROR=0,t.NO_CONTENT=304,t.INVALID_PARAM=400,t.INVALID_TOKEN=401,t.OAUTH_ERROR=403,t.NOT_FOUND=404,t.INVALID_METHOD=405,t.NOT_ACCEPTABLE=406,t.CONFLICT=409,t.RATE_LIMITED=429,t.SERVER_ERROR=503,t.OVER_QUOTA=507,t.prototype.toString=function(){return"Dropbox API error "+this.status+" from "+this.method+" "+this.url+" :: "+this.responseText},t.prototype.inspect=function(){return this.toString()},t}(),h.AuthDriver=function(){function t(){}return t.prototype.authType=function(){return"code"},t.prototype.url=function(){return"https://some.url"},t.prototype.doAuthorize=function(t,e,r,n){return n({code:"access-code"})},t.prototype.getStateParam=function(t,e){return e(h.Util.Oauth.randomAuthStateParam())},t.prototype.resumeAuthorize=function(t,e,r){return r({code:"access-code"})},t.prototype.onAuthStepChange=function(t,e){return e()},t.oauthQueryParams=["access_token","expires_in","scope","token_type","code","error","error_description","error_uri","mac_key","mac_algorithm"].sort(),t}(),h.AuthDriver.autoConfigure=function(t){if("undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.id)return void(chrome.tabs&&chrome.tabs.create?t.authDriver(new h.AuthDriver.ChromeExtension):t.authDriver(new h.AuthDriver.ChromeApp));if("undefined"!=typeof window){if(window.cordova)return void t.authDriver(new h.AuthDriver.Cordova);window&&window.navigator&&t.authDriver(new h.AuthDriver.Redirect)}},h.AuthDriver.BrowserBase=function(){function t(t){t?(this.rememberUser="rememberUser"in t?t.rememberUser:!0,this.scope=t.scope||"default"):(this.rememberUser=!0,this.scope="default"),this.storageKey=null,this.storage=h.AuthDriver.BrowserBase.localStorage(),this.stateRe=/^[^#]+\#(.*&)?state=([^&]+)(&|$)/}return t.prototype.authType=function(){return"token"},t.prototype.onAuthStepChange=function(t,e){switch(this.setStorageKey(t),t.authStep){case h.Client.RESET:return this.loadCredentials(function(r){return function(n){return n?(t.setCredentials(n),t.authStep!==h.Client.DONE?e():r.rememberUser?(t.setCredentials(n),e()):r.forgetCredentials(e)):e()}}(this));case h.Client.DONE:return this.rememberUser?this.storeCredentials(t.credentials(),e):this.forgetCredentials(e);case h.Client.SIGNED_OUT:return this.forgetCredentials(e);case h.Client.ERROR:return this.forgetCredentials(e);default:return e(),this}},t.prototype.setStorageKey=function(t){return this.storageKey="dropbox-auth:"+this.scope+":"+t.appHash(),this},t.prototype.storeCredentials=function(t,e){var r,n,i,o,s;n=JSON.stringify(t);try{this.storage.setItem(this.storageKey,n)}catch(r){o=r,i=encodeURIComponent(this.storageKey),s=encodeURIComponent(n),document.cookie=i+"="+s+"; path=/"}return e(),this},t.prototype.loadCredentials=function(t){var e,r,n,i,o,s,a,u,h;try{o=this.storage.getItem(this.storageKey)}catch(r){h=r,o=null}if(null===o&&(a=encodeURIComponent(this.storageKey),u=a.replace(/[.*+()]/g,"\\$&"),e=new RegExp("(^|(;\\s*))"+a+"=([^;]*)(;|$)"),(s=e.exec(document.cookie))&&(o=decodeURIComponent(s[3]))),!o)return t(null),this;try{t(JSON.parse(o))}catch(n){i=n,t(null)}return this},t.prototype.forgetCredentials=function(t){var e,r,n,i;try{this.storage.removeItem(this.storageKey)}catch(e){i=e,n=encodeURIComponent(this.storageKey),r=new Date(0).toGMTString(),document.cookie=n+"={}; expires="+r+"; path=/"}return t(),this},t.prototype.locationStateParam=function(t){var e,r;return e=t||h.AuthDriver.BrowserBase.currentLocation(),r=this.stateRe.exec(e),r?decodeURIComponent(r[2]):null},t.prototype.replaceUrlBasename=function(t,e){var r,n,i;return n=t.indexOf("#"),-1!==n&&(t=t.substring(0,n)),i=t.indexOf("?"),-1!==i&&(t=t.substring(0,i)),r=t.split("/"),r[r.length-1]=e,r.join("/")},t.localStorage=function(){var t,e;if("undefined"==typeof window)return null;try{return window.localStorage}catch(e){return t=e,null}},t.currentLocation=function(){return window.location.href},t.cleanupLocation=function(){var t,e;window.history&&window.history.replaceState?(e=this.currentLocation(),t=e.indexOf("#"),window.history.replaceState({},document.title,e.substring(0,t))):window.location.hash=""},t}(),h.AuthDriver.Redirect=function(t){function e(t){e.__super__.constructor.call(this,t),this.receiverUrl=this.baseUrl(t)}return c(e,t),e.prototype.baseUrl=function(t){var e,r;if(r=h.AuthDriver.BrowserBase.currentLocation(),t){if(t.redirectUrl)return t.redirectUrl;if(t.redirectFile)return this.replaceUrlBasename(r,t.redirectFile)}return e=r.indexOf("#"),-1!==e&&(r=r.substring(0,e)),r},e.prototype.url=function(){return this.receiverUrl},e.prototype.doAuthorize=function(t,e,r){return this.storeCredentials(r.credentials(),function(){return window.location.assign(t)})},e.prototype.resumeAuthorize=function(t,e,r){var n;return this.locationStateParam()===t?(n=h.AuthDriver.BrowserBase.currentLocation(),h.AuthDriver.BrowserBase.cleanupLocation(),r(h.Util.Oauth.queryParamsFromUrl(n))):this.forgetCredentials(function(){return r({error:"Authorization error"})})},e}(h.AuthDriver.BrowserBase),h.AuthDriver.Popup=function(t){function e(t){e.__super__.constructor.call(this,t),this.receiverUrl=this.baseUrl(t)}return c(e,t),e.prototype.url=function(){return this.receiverUrl},e.prototype.doAuthorize=function(t,e,r,n){return this.listenForMessage(e,n),this.openWindow(t)},e.prototype.baseUrl=function(t){var e;if(e=h.AuthDriver.BrowserBase.currentLocation(),t){if(t.receiverUrl)return t.receiverUrl;if(t.receiverFile)return this.replaceUrlBasename(e,t.receiverFile)}return e},e.prototype.openWindow=function(t){return window.open(t,"_dropboxOauthSigninWindow",this.popupWindowSpec(980,700))},e.prototype.popupWindowSpec=function(t,e){var r,n,i,o,s,a,u,h,l,p;return l=null!=(o=window.screenX)?o:window.screenLeft,p=null!=(s=window.screenY)?s:window.screenTop,h=null!=(a=window.outerWidth)?a:document.documentElement.clientWidth,r=null!=(u=window.outerHeight)?u:document.documentElement.clientHeight,n=Math.round(l+(h-t)/2),i=Math.round(p+(r-e)/2.5),l>n&&(n=l),p>i&&(i=p),"width="+t+",height="+e+","+("left="+n+",top="+i)+"dialog=yes,dependent=yes,scrollbars=yes,location=yes"},e.prototype.listenForMessage=function(t,e){var r;return r=function(n){return function(i){var o,s,a,u;o=i.data?i.data:i;try{u=JSON.parse(o)._dropboxjs_oauth_info}catch(s){return void(a=s)}if(u)return n.locationStateParam(u)===t?(t=!1,window.removeEventListener("message",r),h.AuthDriver.Popup.onMessage.removeListener(r),e(h.Util.Oauth.queryParamsFromUrl(o))):void 0}}(this),window.addEventListener("message",r,!1),h.AuthDriver.Popup.onMessage.addListener(r)},e.locationOrigin=function(t){var e;return(e=/^(file:\/\/[^\?\#]*)(\?|\#|$)/.exec(t))?e[1]:(e=/^([^\:]+\:\/\/[^\/\?\#]*)(\/|\?|\#|$)/.exec(t),e?e[1]:t)},e.oauthReceiver=function(){window.addEventListener("load",function(){var t,e,r,n,i,o,s,a;if(a=window.location.href,i=JSON.stringify({_dropboxjs_oauth_info:a}),h.AuthDriver.BrowserBase.cleanupLocation(),o=window.opener,window.parent!==window.top&&(o||(o=window.parent)),o){try{s=window.location.origin||locationOrigin(a),o.postMessage(i,s),window.close()}catch(t){n=t}try{return o.Dropbox.AuthDriver.Popup.onMessage.dispatch(i),window.close()}catch(e){r=e}}})},e.onMessage=new h.Util.EventSource,e}(h.AuthDriver.BrowserBase),h.AuthDriver.ChromeBase=function(t){function e(t){e.__super__.constructor.call(this,t),this.storageKey="dropbox_js_"+this.scope+"_credentials"}return c(e,t),e.prototype.onAuthStepChange=function(t,e){switch(t.authStep){case h.Client.RESET:return this.loadCredentials(function(r){return r&&t.setCredentials(r),e()});case h.Client.DONE:return this.storeCredentials(t.credentials(),e);case h.Client.SIGNED_OUT:return this.forgetCredentials(e);case h.Client.ERROR:return this.forgetCredentials(e);default:return e()}},e.prototype.url=function(){return this.receiverUrl},e.prototype.storeCredentials=function(t,e){var r;return r={},r[this.storageKey]=t,chrome.storage.local.set(r,e),this},e.prototype.loadCredentials=function(t){return chrome.storage.local.get(this.storageKey,function(e){return function(r){return t(r[e.storageKey]||null)}}(this)),this},e.prototype.forgetCredentials=function(t){return chrome.storage.local.remove(this.storageKey,t),this},e}(h.AuthDriver.BrowserBase),h.AuthDriver.ChromeApp=function(t){function e(t){e.__super__.constructor.call(this,t),this.receiverUrl="https://"+chrome.runtime.id+".chromiumapp.org/"}return c(e,t),e.prototype.doAuthorize=function(t,e,r,n){return chrome.identity.launchWebAuthFlow({url:t,interactive:!0},function(t){return function(r){return t.locationStateParam(r)===e?(e=!1,n(h.Util.Oauth.queryParamsFromUrl(r))):void 0}}(this))},e}(h.AuthDriver.ChromeBase),h.AuthDriver.ChromeExtension=function(t){function e(t){var r;e.__super__.constructor.call(this,t),r=t&&t.receiverPath||"chrome_oauth_receiver.html",this.receiverUrl=chrome.runtime.getURL(r)}return c(e,t),e.prototype.doAuthorize=function(t,e,r,n){var i,o;return o=null,i=function(t){return function(r,s){var a;if((!s||!s.tab||s.tab.url.substring(0,t.receiverUrl.length)===t.receiverUrl)&&r.dropbox_oauth_receiver_href)return a=r.dropbox_oauth_receiver_href,t.locationStateParam(a)===e?(e=!1,o&&chrome.tabs.remove(o.id),chrome.runtime.onMessage.removeListener(i),n(h.Util.Oauth.queryParamsFromUrl(a))):void 0}}(this),chrome.runtime.onMessage.addListener(i),chrome.tabs.create({url:t,active:!0,pinned:!1},function(t){return o=t})},e.oauthReceiver=function(){return window.addEventListener("load",function(){var t;return t=window.location.href,window.location.hash="",chrome.runtime.sendMessage({dropbox_oauth_receiver_href:t}),window.close?window.close():void 0})},e}(h.AuthDriver.ChromeBase),h.AuthDriver.Cordova=function(t){function e(t){e.__super__.constructor.call(this,t)}return c(e,t),e.prototype.url=function(){return"https://www.dropbox.com/1/oauth2/redirect_receiver"},e.prototype.doAuthorize=function(t,e,r,n){var i,o,s,a,u;return o=window.open(t,"_blank","location=yes,closebuttoncaption=Cancel"),a=!1,i=/^[^\/]*\/\/[^\/]*\//.exec(t)[0],u=!1,s=function(t){return function(r){if(r.url&&t.locationStateParam(r.url)===e){if(u)return;return o.removeEventListener("loadstart",s),o.removeEventListener("loaderror",s),o.removeEventListener("loadstop",s),o.removeEventListener("exit",s),u=!0,window.setTimeout(function(){return o.close()},10),void n(h.Util.Oauth.queryParamsFromUrl(r.url))}if("exit"===r.type){if(u)return;o.removeEventListener("loadstart",s),o.removeEventListener("loaderror",s),o.removeEventListener("loadstop",s),o.removeEventListener("exit",s),u=!0,n(new AuthError("error=access_denied&error_description=User+closed+browser+window"))}}}(this),o.addEventListener("loadstart",s),o.addEventListener("loaderror",s),o.addEventListener("loadstop",s),o.addEventListener("exit",s)},e}(h.AuthDriver.BrowserBase),h.AuthError=function(){function t(t){var e;if(!t.error)throw new Error("Not an OAuth 2.0 error: "+JSON.stringify(t));e="object"==typeof t.error&&t.error.error?t.error:t,this.code=e.error,this.description=e.error_description||null,this.uri=e.error_uri||null}return t.prototype.code=null,t.prototype.description=null,t.prototype.uri=null,t.ACCESS_DENIED="access_denied",t.INVALID_REQUEST="invalid_request",t.UNAUTHORIZED_CLIENT="unauthorized_client",t.INVALID_GRANT="invalid_grant",t.INVALID_SCOPE="invalid_scope",t.UNSUPPORTED_GRANT_TYPE="unsupported_grant_type",t.UNSUPPORTED_RESPONSE_TYPE="unsupported_response_type",t.SERVER_ERROR="server_error",t.TEMPORARILY_UNAVAILABLE="temporarily_unavailable",t.prototype.toString=function(){return"Dropbox OAuth error "+this.code+" :: "+this.description},t.prototype.inspect=function(){return this.toString()},t}(),h.Client=function(){function e(t){this._serverRoot=t.server||this._defaultServerRoot(),"maxApiServer"in t?this._maxApiServer=t.maxApiServer:this._maxApiServer=this._defaultMaxApiServer(),this._authServer=t.authServer||this._defaultAuthServer(),this._fileServer=t.fileServer||this._defaultFileServer(),this._downloadServer=t.downloadServer||this._defaultDownloadServer(),this._notifyServer=t.notifyServer||this._defaultNotifyServer(),this.onXhr=new h.Util.EventSource({cancelable:!0}),this.onError=new h.Util.EventSource,this.onAuthStepChange=new h.Util.EventSource,this._xhrOnErrorHandler=function(t){return function(e,r){return t._handleXhrError(e,r)}}(this),this._oauth=new h.Util.Oauth(t),this._uid=t.uid||null,this.authStep=this._oauth.step(),this._driver=null,this.authError=null,this._credentials=null,this.setupUrls()}return e.prototype.onXhr=null,e.prototype.onError=null,e.prototype.onAuthStepChange=null,e.prototype.authDriver=function(t){return this._driver=t,this},e.prototype.dropboxUid=function(){return this._uid},e.prototype.credentials=function(){return this._credentials||this._computeCredentials(),this._credentials},e.prototype.authenticate=function(e,r){var n,i,o,s,a;if(r||"function"!=typeof e||(r=e,e=null),s=e&&"interactive"in e?e.interactive:!0,!this._driver&&this.authStep!==t.DONE&&(h.AuthDriver.autoConfigure(this),!this._driver))throw new Error("OAuth driver auto-configuration failed. Call authDriver.");if(this.authStep===t.ERROR)throw new Error("Client got in an error state. Call reset() to reuse it!");return i=function(e){return function(){return e.authStep=e._oauth.step(),e.authStep===t.ERROR&&(e.authError=e._oauth.error()),e._credentials=null,e.onAuthStepChange.dispatch(e),o()}}(this),n=function(e){return function(){return e.authStep=t.ERROR,e._credentials=null,e.onAuthStepChange.dispatch(e),o()}}(this),a=null,o=function(e){return function(){var u;if(a!==e.authStep&&(a=e.authStep,e._driver&&e._driver.onAuthStepChange))return void e._driver.onAuthStepChange(e,o);switch(e.authStep){case t.RESET:return s?(e._driver.getStateParam&&e._driver.getStateParam(function(r){return e.client.authStep===t.RESET&&e._oauth.setAuthStateParam(r),i()}),e._oauth.setAuthStateParam(h.Util.Oauth.randomAuthStateParam()),i()):void(r&&r(null,e));case t.PARAM_SET:return s?(u=e.authorizeUrl(),e._driver.doAuthorize(u,e._oauth.authStateParam(),e,function(t){return e._oauth.processRedirectParams(t),t.uid&&(e._uid=t.uid),i()})):void(r&&r(null,e));case t.PARAM_LOADED:return e._driver.resumeAuthorize?e._driver.resumeAuthorize(e._oauth.authStateParam(),e,function(t){return e._oauth.processRedirectParams(t),t.uid&&(e._uid=t.uid),i()}):(e._oauth.setAuthStateParam(e._oauth.authStateParam()),void i());case t.AUTHORIZED:return e.getAccessToken(function(t,r){return t?(e.authError=t,n()):(e._oauth.processRedirectParams(r),e._uid=r.uid,i())});case t.DONE:r&&r(null,e);break;case t.SIGNED_OUT:return e.authStep=t.RESET,e.reset(),o();case t.ERROR:r&&r(e.authError,e)}}}(this),o(),this},e.prototype.isAuthenticated=function(){return this.authStep===t.DONE},e.prototype.signOut=function(e,r){var n,i;if(r||"function"!=typeof e||(r=e,e=null),n=e&&e.mustInvalidate,this.authStep!==t.DONE)throw new Error("This client doesn't have a user's token");return i=new h.Util.Xhr("POST",this._urls.signOut),i.signWithOauth(this._oauth),this._dispatchXhr(i,function(e){return function(i){if(i)if(i.status===h.ApiError.INVALID_TOKEN)i=null;else if(n)return void(r&&r(i));return e.authStep=t.RESET,e.reset(),e.authStep=t.SIGNED_OUT,e.onAuthStepChange.dispatch(e),e._driver&&e._driver.onAuthStepChange?e._driver.onAuthStepChange(e,function(){return r?r(null):void 0}):r?r(null):void 0}}(this))},e.prototype.signOff=function(t,e){return this.signOut(t,e)},e.prototype.getAccountInfo=function(t,e){var r,n;return e||"function"!=typeof t||(e=t,t=null),r=!1,t&&t.httpCache&&(r=!0),n=new h.Util.Xhr("GET",this._urls.accountInfo),n.signWithOauth(this._oauth,r),this._dispatchXhr(n,function(t,r){return e(t,h.AccountInfo.parse(r),r)})},e.prototype.getUserInfo=function(t,e){return this.getAccountInfo(t,e)},e.prototype.readFile=function(t,e,r){var n,i,o,s,a,u,l;return r||"function"!=typeof e||(r=e,e=null),i={},u="text",s=null,n=!1,e&&(e.versionTag?i.rev=e.versionTag:e.rev&&(i.rev=e.rev),e.arrayBuffer?u="arraybuffer":e.blob?u="blob":e.buffer?u="buffer":e.binary&&(u="b"),e.length?(null!=e.start?(a=e.start,o=e.start+e.length-1):(a="",o=e.length),s="bytes="+a+"-"+o):null!=e.start&&(s="bytes="+e.start+"-"),e.httpCache&&(n=!0)),l=new h.Util.Xhr("GET",this._urls.getFile+"/"+this._urlEncodePath(t)),l.setParams(i).signWithOauth(this._oauth,n),l.setResponseType(u),s&&(s&&l.setHeader("Range",s),l.reportResponseHeaders()),this._dispatchXhr(l,function(t,e,n,i){var o;return o=i?h.Http.RangeInfo.parse(i["content-range"]):null,r(t,e,h.File.Stat.parse(n),o)})},e.prototype.writeFile=function(t,e,r,n){var i;return n||"function"!=typeof r||(n=r,r=null),i=h.Util.Xhr.canSendForms&&"object"==typeof e,i?this._writeFileUsingForm(t,e,r,n):this._writeFileUsingPut(t,e,r,n)},e.prototype._writeFileUsingForm=function(t,e,r,n){var i,o,s,a;return s=t.lastIndexOf("/"),-1===s?(i=t,t=""):(i=t.substring(s),t=t.substring(0,s)),o={file:i},r&&(r.noOverwrite&&(o.overwrite="false"),r.lastVersionTag?o.parent_rev=r.lastVersionTag:(r.parentRev||r.parent_rev)&&(o.parent_rev=r.parentRev||r.parent_rev)),a=new h.Util.Xhr("POST",this._urls.postFile+"/"+this._urlEncodePath(t)),a.setParams(o).signWithOauth(this._oauth).setFileField("file",i,e,"application/octet-stream"),delete o.file,this._dispatchXhr(a,function(t,e){return n?n(t,h.File.Stat.parse(e)):void 0})},e.prototype._writeFileUsingPut=function(t,e,r,n){var i,o;return i={},r&&(r.noOverwrite&&(i.overwrite="false"),r.lastVersionTag?i.parent_rev=r.lastVersionTag:(r.parentRev||r.parent_rev)&&(i.parent_rev=r.parentRev||r.parent_rev)),o=new h.Util.Xhr("POST",this._urls.putFile+"/"+this._urlEncodePath(t)),o.setBody(e).setParams(i).signWithOauth(this._oauth),this._dispatchXhr(o,function(t,e){return n?n(t,h.File.Stat.parse(e)):void 0})},e.prototype.resumableUploadStep=function(t,e,r){var n,i;return e?(n={offset:e.offset},e.tag&&(n.upload_id=e.tag)):n={offset:0},i=new h.Util.Xhr("POST",this._urls.chunkedUpload),i.setBody(t).setParams(n).signWithOauth(this._oauth),this._dispatchXhr(i,function(t,e){return t&&t.status===h.ApiError.INVALID_PARAM&&t.response&&t.response.upload_id&&t.response.offset?r(null,h.Http.UploadCursor.parse(t.response)):r(t,h.Http.UploadCursor.parse(e))})},e.prototype.resumableUploadFinish=function(t,e,r,n){var i,o;return n||"function"!=typeof r||(n=r,r=null),i={upload_id:e.tag},r&&(r.lastVersionTag?i.parent_rev=r.lastVersionTag:(r.parentRev||r.parent_rev)&&(i.parent_rev=r.parentRev||r.parent_rev),r.noOverwrite&&(i.overwrite="false")),o=new h.Util.Xhr("POST",this._urls.commitChunkedUpload+"/"+this._urlEncodePath(t)),o.setParams(i).signWithOauth(this._oauth),this._dispatchXhr(o,function(t,e){return n?n(t,h.File.Stat.parse(e)):void 0})},e.prototype.stat=function(t,e,r){var n,i,o;return r||"function"!=typeof e||(r=e,e=null),i={},n=!1,e&&(e.versionTag?i.rev=e.versionTag:e.rev&&(i.rev=e.rev),e.contentHash?i.hash=e.contentHash:e.hash&&(i.hash=e.hash),(e.removed||e.deleted)&&(i.include_deleted="true"),e.readDir&&(i.list="true",e.readDir!==!0&&(i.file_limit=e.readDir.toString())),e.cacheHash&&(i.hash=e.cacheHash),e.httpCache&&(n=!0)),i.include_deleted||(i.include_deleted="false"),i.list||(i.list="false"),o=new h.Util.Xhr("GET",this._urls.metadata+"/"+this._urlEncodePath(t)),o.setParams(i).signWithOauth(this._oauth,n),this._dispatchXhr(o,function(t,e){var n,i,o;return o=h.File.Stat.parse(e),n=(null!=e?e.contents:void 0)?function(){var t,r,n,o;for(n=e.contents,o=[],t=0,r=n.length;r>t;t++)i=n[t],o.push(h.File.Stat.parse(i));return o}():void 0,r(t,o,n)})},e.prototype.readdir=function(t,e,r){var n;return r||"function"!=typeof e||(r=e,e=null),n={readDir:!0},e&&(null!=e.limit&&(n.readDir=e.limit),e.versionTag?n.versionTag=e.versionTag:e.rev&&(n.versionTag=e.rev),e.contentHash?n.contentHash=e.contentHash:e.hash&&(n.contentHash=e.hash),(e.removed||e.deleted)&&(n.removed=e.removed||e.deleted),e.httpCache&&(n.httpCache=e.httpCache)),this.stat(t,n,function(t,e,n){var i,o;return i=n?function(){var t,e,r;for(r=[],t=0,e=n.length;e>t;t++)o=n[t],r.push(o.name);return r}():null,r(t,i,e,n)})},e.prototype.metadata=function(t,e,r){return this.stat(t,e,r)},e.prototype.makeUrl=function(t,e,r){var n,i,o,s,a;return r||"function"!=typeof e||(r=e,e=null),i=e&&(e["long"]||e.longUrl||e.downloadHack)?{short_url:"false"}:{},t=this._urlEncodePath(t),o=this._urls.shares+"/"+t,n=!1,s=!1,e&&(e.downloadHack?(n=!0,s=!0):e.download&&(n=!0,o=this._urls.media+"/"+t)),a=new h.Util.Xhr("POST",o).setParams(i).signWithOauth(this._oauth),this._dispatchXhr(a,function(t){return function(e,i){return s&&(null!=i?i.url:void 0)&&(i.url=i.url.replace(t._authServer,t._downloadServer)),r(e,h.File.ShareUrl.parse(i,n))}}(this))},e.prototype.history=function(t,e,r){var n,i,o;return r||"function"!=typeof e||(r=e,e=null),i={},n=!1,e&&(null!=e.limit&&(i.rev_limit=e.limit),e.httpCache&&(n=!0)),o=new h.Util.Xhr("GET",this._urls.revisions+"/"+this._urlEncodePath(t)),o.setParams(i).signWithOauth(this._oauth,n),this._dispatchXhr(o,function(t,e){var n,i;return i=e?function(){var t,r,i;for(i=[],t=0,r=e.length;r>t;t++)n=e[t],i.push(h.File.Stat.parse(n));return i}():void 0,r(t,i)})},e.prototype.revisions=function(t,e,r){return this.history(t,e,r)},e.prototype.thumbnailUrl=function(t,e){var r;return r=this.thumbnailXhr(t,e),r.addOauthParams(this._oauth).paramsToUrl().url},e.prototype.readThumbnail=function(t,e,r){var n,i;return r||"function"!=typeof e||(r=e,e=null),n="b",e&&(e.blob&&(n="blob"),e.arrayBuffer&&(n="arraybuffer"),e.buffer&&(n="buffer")),i=this.thumbnailXhr(t,e),i.setResponseType(n).signWithOauth(this._oauth),this._dispatchXhr(i,function(t,e,n){return r(t,e,h.File.Stat.parse(n))})},e.prototype.thumbnailXhr=function(t,e){var r,n;return r={},e&&(e.format?r.format=e.format:e.png&&(r.format="png"),e.size&&(r.size=e.size)),n=new h.Util.Xhr("GET",this._urls.thumbnails+"/"+this._urlEncodePath(t)),n.setParams(r)},e.prototype.revertFile=function(t,e,r){var n;return n=new h.Util.Xhr("POST",this._urls.restore+"/"+this._urlEncodePath(t)),n.setParams({rev:e}).signWithOauth(this._oauth),this._dispatchXhr(n,function(t,e){return r?r(t,h.File.Stat.parse(e)):void 0})},e.prototype.restore=function(t,e,r){return this.revertFile(t,e,r)},e.prototype.findByName=function(t,e,r,n){var i,o,s;return n||"function"!=typeof r||(n=r,r=null),o={query:e},i=!1,r&&(null!=r.limit&&(o.file_limit=r.limit),(r.removed||r.deleted)&&(o.include_deleted=!0),r.httpCache&&(i=!0)),s=new h.Util.Xhr("GET",this._urls.search+"/"+this._urlEncodePath(t)),s.setParams(o).signWithOauth(this._oauth,i),this._dispatchXhr(s,function(t,e){var r,i;return i=e?function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)r=e[t],i.push(h.File.Stat.parse(r));return i}():void 0,n(t,i)})},e.prototype.search=function(t,e,r,n){return this.findByName(t,e,r,n)},e.prototype.makeCopyReference=function(t,e){var r;return r=new h.Util.Xhr("GET",this._urls.copyRef+"/"+this._urlEncodePath(t)),r.signWithOauth(this._oauth),this._dispatchXhr(r,function(t,r){return e(t,h.File.CopyReference.parse(r))})},e.prototype.copyRef=function(t,e){return this.makeCopyReference(t,e)},e.prototype.pullChanges=function(t,e){var r,n;return e||"function"!=typeof t||(e=t,t=null),r=t?t.cursorTag?{cursor:t.cursorTag}:{cursor:t}:{},n=new h.Util.Xhr("POST",this._urls.delta),n.setParams(r).signWithOauth(this._oauth),this._dispatchXhr(n,function(t,r){return e(t,h.Http.PulledChanges.parse(r))})},e.prototype.delta=function(t,e){return this.pullChanges(t,e)},e.prototype.pollForChanges=function(t,e,r){var n,i;return r||"function"!=typeof e||(r=e,e=null),n=t.cursorTag?{cursor:t.cursorTag}:{cursor:t},e&&"timeout"in e&&(n.timeout=e.timeout),i=new h.Util.Xhr("GET",this._urls.longpollDelta),i.setParams(n),this._dispatchXhr(i,function(t,e){var n,i;if("string"==typeof e)try{e=JSON.parse(e)}catch(n){i=n,e=null}return r(t,h.Http.PollResult.parse(e))})},e.prototype.mkdir=function(t,e){var r;return r=new h.Util.Xhr("POST",this._urls.fileopsCreateFolder),r.setParams({root:"auto",path:this._normalizePath(t)}).signWithOauth(this._oauth),this._dispatchXhr(r,function(t,r){return e?e(t,h.File.Stat.parse(r)):void 0})},e.prototype.remove=function(t,e){var r;return r=new h.Util.Xhr("POST",this._urls.fileopsDelete),r.setParams({root:"auto",path:this._normalizePath(t)}).signWithOauth(this._oauth),this._dispatchXhr(r,function(t,r){return e?e(t,h.File.Stat.parse(r)):void 0})},e.prototype.unlink=function(t,e){return this.remove(t,e)},e.prototype["delete"]=function(t,e){return this.remove(t,e)},e.prototype.copy=function(t,e,r){var n,i,o;return r||"function"!=typeof n||(r=n,n=null),i={root:"auto",to_path:this._normalizePath(e)},t instanceof h.File.CopyReference?i.from_copy_ref=t.tag:i.from_path=this._normalizePath(t),o=new h.Util.Xhr("POST",this._urls.fileopsCopy),o.setParams(i).signWithOauth(this._oauth),this._dispatchXhr(o,function(t,e){return r?r(t,h.File.Stat.parse(e)):void 0})},e.prototype.move=function(t,e,r){var n,i;return r||"function"!=typeof n||(r=n,n=null),i=new h.Util.Xhr("POST",this._urls.fileopsMove),i.setParams({root:"auto",from_path:this._normalizePath(t),to_path:this._normalizePath(e)}).signWithOauth(this._oauth),this._dispatchXhr(i,function(t,e){return r?r(t,h.File.Stat.parse(e)):void 0})},e.prototype.appInfo=function(t,e){var r;return e||"function"!=typeof t||(e=t,t=this._oauth.credentials().key),r=new h.Util.Xhr("GET",this._urls.appsInfo),r.setParams({app_key:t}),this._dispatchXhr(r,function(r,n){return e(r,h.Http.AppInfo.parse(n,t))})},e.prototype.isAppDeveloper=function(t,e,r){var n;return"object"==typeof t&&"uid"in t&&(t=t.uid),r||"function"!=typeof e?"object"==typeof e&&"key"in e&&(e=e.key):(r=e,e=this._oauth.credentials().key),n=new h.Util.Xhr("GET",this._urls.appsCheckDeveloper),n.setParams({app_key:e,uid:t}),this._dispatchXhr(n,function(t,e){return e?r(t,e.is_developer):r(t)})},e.prototype.hasOauthRedirectUri=function(t,e,r){var n;return r||"function"!=typeof e?"object"==typeof e&&"key"in e&&(e=e.key):(r=e,e=this._oauth.credentials().key),n=new h.Util.Xhr("GET",this._urls.appsCheckRedirectUri),n.setParams({app_key:e,redirect_uri:t}),this._dispatchXhr(n,function(t,e){return e?r(t,e.has_redirect_uri):r(t)})},e.prototype.reset=function(){var t;return this._uid=null,this._oauth.reset(),t=this.authStep,this.authStep=this._oauth.step(),t!==this.authStep&&this.onAuthStepChange.dispatch(this),this.authError=null,this._credentials=null,this},e.prototype.setCredentials=function(t){var e;return e=this.authStep,this._oauth.setCredentials(t),this.authStep=this._oauth.step(),this._uid=t.uid||null,this.authError=null,this._credentials=null,e!==this.authStep&&this.onAuthStepChange.dispatch(this),this},e.prototype.appHash=function(){return this._oauth.appHash()},e.prototype.setupUrls=function(){return this._apiServer=this._chooseApiServer(),this._urls={authorize:this._authServer+"/1/oauth2/authorize",token:this._apiServer+"/1/oauth2/token",signOut:this._apiServer+"/1/unlink_access_token",accountInfo:this._apiServer+"/1/account/info",getFile:this._fileServer+"/1/files/auto",postFile:this._fileServer+"/1/files/auto",putFile:this._fileServer+"/1/files_put/auto",metadata:this._apiServer+"/1/metadata/auto",delta:this._apiServer+"/1/delta",longpollDelta:this._notifyServer+"/1/longpoll_delta",revisions:this._apiServer+"/1/revisions/auto",restore:this._apiServer+"/1/restore/auto",search:this._apiServer+"/1/search/auto",shares:this._apiServer+"/1/shares/auto",media:this._apiServer+"/1/media/auto",copyRef:this._apiServer+"/1/copy_ref/auto",thumbnails:this._fileServer+"/1/thumbnails/auto",chunkedUpload:this._fileServer+"/1/chunked_upload",commitChunkedUpload:this._fileServer+"/1/commit_chunked_upload/auto",fileopsCopy:this._apiServer+"/1/fileops/copy",fileopsCreateFolder:this._apiServer+"/1/fileops/create_folder",fileopsDelete:this._apiServer+"/1/fileops/delete",fileopsMove:this._apiServer+"/1/fileops/move",appsInfo:this._apiServer+"/1/apps/info",appsCheckDeveloper:this._apiServer+"/1/apps/check_developer",appsCheckRedirectUri:this._apiServer+"/1/apps/check_redirect_uri"}},e.prototype._chooseApiServer=function(){var t,e;return e=Math.floor(Math.random()*(this._maxApiServer+1)),t=0===e?"":e.toString(),this._serverRoot.replace("$",t)},e.prototype.authStep=null,e.ERROR=0,e.RESET=1,e.PARAM_SET=2,e.PARAM_LOADED=3,e.AUTHORIZED=4,e.DONE=5,e.SIGNED_OUT=6,e.prototype._urlEncodePath=function(t){return h.Util.Xhr.urlEncodeValue(this._normalizePath(t)).replace(/%2F/gi,"/")},e.prototype._normalizePath=function(t){var e;if("/"===t.substring(0,1)){for(e=1;"/"===t.substring(e,e+1);)e+=1;return t.substring(e)}return t},e.prototype.authorizeUrl=function(){var t;return t=this._oauth.authorizeUrlParams(this._driver.authType(),this._driver.url()),this._urls.authorize+"?"+h.Util.Xhr.urlEncode(t)},e.prototype.getAccessToken=function(t){var e,r;return e=this._oauth.accessTokenParams(this._driver.url()),
r=new h.Util.Xhr("POST",this._urls.token).setParams(e).addOauthParams(this._oauth),this._dispatchXhr(r,function(e,r){return e&&e.status===h.ApiError.INVALID_PARAM&&e.response&&e.response.error&&(e=new h.AuthError(e.response)),t(e,r)})},e.prototype._dispatchXhr=function(t,e){var r;return t.setCallback(e),t.onError=this._xhrOnErrorHandler,t.prepare(),r=t.xhr,this.onXhr.dispatch(t)&&t.send(),r},e.prototype._handleXhrError=function(e,r){return e.status===h.ApiError.INVALID_TOKEN&&this.authStep===t.DONE&&(this.authError=e,this.authStep=t.ERROR,this.onAuthStepChange.dispatch(this),this._driver&&this._driver.onAuthStepChange)?(this._driver.onAuthStepChange(this,function(t){return function(){return t.onError.dispatch(e),r(e)}}(this)),null):(this.onError.dispatch(e),void r(e))},e.prototype._defaultServerRoot=function(){return"https://api$.dropbox.com"},e.prototype._defaultAuthServer=function(){return this._serverRoot.replace("api$","www")},e.prototype._defaultFileServer=function(){return this._serverRoot.replace("api$","api-content")},e.prototype._defaultDownloadServer=function(){return"https://dl.dropboxusercontent.com"},e.prototype._defaultNotifyServer=function(){return this._serverRoot.replace("api$","api-notify")},e.prototype._defaultMaxApiServer=function(){return 30},e.prototype._computeCredentials=function(){var t;t=this._oauth.credentials(),this._uid&&(t.uid=this._uid),this._serverRoot!==this._defaultServerRoot()&&(t.server=this._serverRoot),this._maxApiServer!==this._defaultMaxApiServer()&&(t.maxApiServer=this._maxApiServer),this._authServer!==this._defaultAuthServer()&&(t.authServer=this._authServer),this._fileServer!==this._defaultFileServer()&&(t.fileServer=this._fileServer),this._downloadServer!==this._defaultDownloadServer()&&(t.downloadServer=this._downloadServer),this._notifyServer!==this._defaultNotifyServer()&&(t.notifyServer=this._notifyServer),this._credentials=t},e}(),t=h.Client,h.File.ShareUrl=function(){function t(t,e){this.url=t.url,this.expiresAt=h.Util.parseDate(t.expires),e===!0?this.isDirect=!0:e===!1?this.isDirect=!1:"direct"in t?this.isDirect=t.direct:this.isDirect=Date.now()-this.expiresAt<=864e5,this.isPreview=!this.isDirect,this._json=null}return t.parse=function(t,e){return t&&"object"==typeof t?new h.File.ShareUrl(t,e):t},t.prototype.url=null,t.prototype.expiresAt=null,t.prototype.isDirect=null,t.prototype.isPreview=null,t.prototype.toJSON=function(){return this._json||(this._json={url:this.url,expires:this.expiresAt.toUTCString(),direct:this.isDirect})},t.prototype.json=function(){return this.toJSON()},t}(),h.File.CopyReference=function(){function t(t){"object"==typeof t?(this.tag=t.copy_ref,this.expiresAt=h.Util.parseDate(t.expires),this._json=t):(this.tag=t,this.expiresAt=new Date(1e3*Math.ceil(Date.now()/1e3)),this._json=null)}return t.parse=function(t){return!t||"object"!=typeof t&&"string"!=typeof t?t:new h.File.CopyReference(t)},t.prototype.tag=null,t.prototype.expiresAt=null,t.prototype.toJSON=function(){return this._json||(this._json={copy_ref:this.tag,expires:this.expiresAt.toUTCString()})},t.prototype.json=function(){return this.toJSON()},t}(),h.File.Stat=function(){function t(t){var e,r,n,i;switch(this._json=t,this.path=t.path,"/"!==this.path.substring(0,1)&&(this.path="/"+this.path),e=this.path.length-1,e>=0&&"/"===this.path.substring(e)&&(this.path=this.path.substring(0,e)),r=this.path.lastIndexOf("/"),this.name=this.path.substring(r+1),this.isFolder=t.is_dir||!1,this.isFile=!this.isFolder,this.isRemoved=t.is_deleted||!1,this.typeIcon=t.icon,(null!=(n=t.modified)?n.length:void 0)?this.modifiedAt=h.Util.parseDate(t.modified):this.modifiedAt=null,(null!=(i=t.client_mtime)?i.length:void 0)?this.clientModifiedAt=h.Util.parseDate(t.client_mtime):this.clientModifiedAt=null,t.root){case"dropbox":this.inAppFolder=!1;break;case"app_folder":this.inAppFolder=!0;break;default:this.inAppFolder=null}this.size=t.bytes||0,this.humanSize=t.size||"",this.hasThumbnail=t.thumb_exists||!1,this.versionTag=t.rev,this.contentHash=t.hash||null,this.isFolder?this.mimeType=t.mime_type||"inode/directory":this.mimeType=t.mime_type||"application/octet-stream"}return t.parse=function(t){return t&&"object"==typeof t?new h.File.Stat(t):t},t.prototype.path=null,t.prototype.name=null,t.prototype.inAppFolder=null,t.prototype.isFolder=null,t.prototype.isFile=null,t.prototype.isRemoved=null,t.prototype.typeIcon=null,t.prototype.versionTag=null,t.prototype.contentHash=null,t.prototype.mimeType=null,t.prototype.size=null,t.prototype.humanSize=null,t.prototype.hasThumbnail=null,t.prototype.modifiedAt=null,t.prototype.clientModifiedAt=null,t.prototype.toJSON=function(){return this._json},t.prototype.json=function(){return this.toJSON()},t}(),h.Http.AppInfo=function(){function t(t,e){var r;this.name=t.name,this._icons=t.icons,r=t.permissions||{},this.canUseDatastores=!!r.datastores,this.canUseFiles=!!r.files,this.canUseFullDropbox="full_dropbox"===r.files,this.hasAppFolder="app_folder"===r.files,e?this.key=e:this.key=t.key||null}return t.parse=function(t,e){return t?new h.Http.AppInfo(t,e):t},t.prototype.name=void 0,t.prototype.key=void 0,t.prototype.canUseDatastores=void 0,t.prototype.canUseFiles=void 0,t.prototype.hasAppFolder=void 0,t.prototype.canUseFullDropbox=void 0,t.prototype.icon=function(t,e){return e||(e=t),this._icons[t+"x"+e]||null},t.ICON_SMALL=64,t.ICON_LARGE=256,t}(),h.Http.PollResult=function(){function t(t){this.hasChanges=t.changes,this.retryAfter=t.backoff||0}return t.parse=function(t){return t?new h.Http.PollResult(t):t},t.prototype.hasChanges=void 0,t.prototype.retryAfter=void 0,t}(),h.Http.PulledChanges=function(){function t(t){var e;this.blankSlate=t.reset||!1,this.cursorTag=t.cursor,this.shouldPullAgain=t.has_more,this.shouldBackOff=!this.shouldPullAgain,t.cursor&&t.cursor.length?this.changes=function(){var r,n,i,o;for(i=t.entries,o=[],r=0,n=i.length;n>r;r++)e=i[r],o.push(h.Http.PulledChange.parse(e));return o}():this.changes=[]}return t.parse=function(t){return t&&"object"==typeof t?new h.Http.PulledChanges(t):t},t.prototype.blankSlate=void 0,t.prototype.cursorTag=void 0,t.prototype.changes=void 0,t.prototype.shouldPullAgain=void 0,t.prototype.shouldBackOff=void 0,t.prototype.cursor=function(){return this.cursorTag},t}(),h.Http.PulledChange=function(){function t(t){this.path=t[0],this.stat=h.File.Stat.parse(t[1]),this.stat?this.wasRemoved=!1:(this.stat=null,this.wasRemoved=!0)}return t.parse=function(t){return t&&"object"==typeof t?new h.Http.PulledChange(t):t},t.prototype.path=void 0,t.prototype.wasRemoved=void 0,t.prototype.stat=void 0,t}(),h.Http.RangeInfo=function(){function t(t){var e;(e=/^bytes (\d*)-(\d*)\/(.*)$/.exec(t))?(this.start=parseInt(e[1]),this.end=parseInt(e[2]),"*"===e[3]?this.size=null:this.size=parseInt(e[3])):(this.start=0,this.end=0,this.size=null)}return t.parse=function(t){return"string"==typeof t?new h.Http.RangeInfo(t):t},t.prototype.start=null,t.prototype.size=null,t.prototype.end=null,t}(),h.Http.UploadCursor=function(){function t(t){this.replace(t)}return t.parse=function(t){return!t||"object"!=typeof t&&"string"!=typeof t?t:new h.Http.UploadCursor(t)},t.prototype.tag=null,t.prototype.offset=null,t.prototype.expiresAt=null,t.prototype.toJSON=function(){return this._json||(this._json={upload_id:this.tag,offset:this.offset,expires:this.expiresAt.toUTCString()})},t.prototype.json=function(){return this.toJSON()},t.prototype.replace=function(t){return"object"==typeof t?(this.tag=t.upload_id||null,this.offset=t.offset||0,this.expiresAt=h.Util.parseDate(t.expires)||Date.now(),this._json=t):(this.tag=t||null,this.offset=0,this.expiresAt=new Date(1e3*Math.floor(Date.now()/1e3)),this._json=null),this},t}(),h.Util.atob=function(t){return h.Env.global.atob(t)},h.Util.btoa=function(t){return h.Env.global.btoa(t)},function(){var t,e,r,n,i,o,s,a,u,l,p,c;if(h.Util.hmac=function(t,r){return e(i(p(t),p(r),t.length,r.length))},h.Util.sha1=function(t){return e(s(p(t),t.length))},h.Util.sha256=function(t){return e(a(p(t),t.length))},h.Env.require)try{r=h.Env.require("crypto"),r.createHmac&&r.createHash&&(h.Util.hmac=function(t,e){var n;return n=r.createHmac("sha1",e),n.update(t),n.digest("base64")},h.Util.sha1=function(t){var e;return e=r.createHash("sha1"),e.update(t),e.digest("base64")},h.Util.sha256=function(t){var e;return e=r.createHash("sha256"),e.update(t),e.digest("base64")})}catch(n){o=n}return i=function(t,e,r,n){var i,o,a,u;return e.length>16&&(e=s(e,n)),a=function(){var t,r;for(r=[],o=t=0;16>t;o=++t)r.push(909522486^e[o]);return r}(),u=function(){var t,r;for(r=[],o=t=0;16>t;o=++t)r.push(1549556828^e[o]);return r}(),i=s(a.concat(t),64+r),s(u.concat(i),84)},s=function(t,e){var r,n,i,o,s,a,u,h,l,p,c,d,f,_,y,v,m;for(t[e>>2]|=1<<31-((3&e)<<3),t[(e+8>>6<<4)+15]=e<<3,v=Array(80),r=1732584193,i=4023233417,s=2562383102,u=271733878,l=3285377520,c=0,_=t.length;_>c;){for(n=r,o=i,a=s,h=u,p=l,d=f=0;80>f;d=++f)16>d?v[d]=0|t[c+d<<2>>2]:(y=(0|v[d-3<<2>>2])^(0|v[d-8<<2>>2])^(0|v[d-14<<2>>2])^(0|v[d-16<<2>>2]),v[d]=y<<1|y>>>31),m=((r<<5|r>>>27)+l|0)+v[d<<2>>2]|0,m=20>d?m+((i&s|~i&u)+1518500249|0)|0:40>d?m+((i^s^u)+1859775393|0)|0:60>d?m+((i&s|i&u|s&u)-1894007588)|0|0:m+((i^s^u)-899497514|0)|0,l=u,u=s,s=i<<30|i>>>2,i=r,r=m;r=n+r|0,i=o+i|0,s=a+s|0,u=h+u|0,l=p+l|0,c=c+16|0}return[r,i,s,u,l]},a=function(t,e){var r,n,i,o,s,a,h,p,c,d,f,_,y,v,m,g,w,S,b,A,E,U,C,O,P,R,T,x,D,k,F,X;for(t[e>>2]|=1<<31-((3&e)<<3),t[(e+8>>6<<4)+15]=e<<3,k=Array(80),r=u[0],i=u[1],s=u[2],p=u[3],d=u[4],_=u[5],v=u[6],A=u[7],U=0,P=t.length;P>U;){for(n=r,o=i,a=s,c=p,f=d,y=_,m=v,E=A,C=O=0;64>O;C=++O)16>C?D=k[C]=0|t[U+C<<2>>2]:(w=0|k[C-15<<2>>2],g=(w<<25|w>>>7)^(w<<14|w>>>18)^w>>>3,b=0|k[C-2<<2>>2],S=(b<<15|b>>>17)^(b<<13|b>>>19)^b>>>10,D=k[C]=(g+(0|k[C-7<<2>>2])|0)+(S+(0|k[C-16<<2>>2])|0)|0),h=d&_^~d&v,R=r&i^r&s^i&s,T=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),x=(d<<26|d>>>6)^(d<<21|d>>>11)^(d<<7|d>>>25),F=((A+x|0)+(h+D|0)|0)+(0|l[C<<2>>2])|0,X=T+R|0,A=v,v=_,_=d,d=p+F|0,p=s,s=i,i=r,r=F+X|0;r=n+r|0,i=o+i|0,s=a+s|0,p=c+p|0,d=f+d|0,_=y+_|0,v=m+v|0,A=E+A|0,U+=16}return[r,i,s,p,d,_,v,A]},c=function(t){return 0>t&&(t=4*(1<<30)+t),t.toString(16)},u=[],l=[],function(){var t,e,r,n,i,o,s;for(e=function(t){return 4294967296*(t-Math.floor(t))|0},o=2,s=[],r=i=0;64>i;r=++i){for(;;){for(n=!0,t=2;o>=t*t;){if(o%t===0){n=!1;break}t+=1}if(n)break;o+=1}8>r&&(u[r]=e(Math.pow(o,.5))),l[r]=e(Math.pow(o,1/3)),s.push(o+=1)}return s}(),e=function(e){var r,n,i,o,s;for(o="",r=0,i=4*e.length;i>r;)n=r,s=(e[n>>2]>>(3-(3&n)<<3)&255)<<16,n+=1,s|=(e[n>>2]>>(3-(3&n)<<3)&255)<<8,n+=1,s|=e[n>>2]>>(3-(3&n)<<3)&255,o+=t[s>>18&63],o+=t[s>>12&63],r+=1,o+=r>=i?"=":t[s>>6&63],r+=1,o+=r>=i?"=":t[63&s],r+=1;return o},t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=function(t){var e,r,n,i,o;for(e=[],i=255,r=n=0,o=t.length;o>=0?o>n:n>o;r=o>=0?++n:--n)e[r>>2]|=(t.charCodeAt(r)&i)<<(3-(3&r)<<3);return e}}(),h.Util.Oauth=function(){function t(t){this._id=null,this._secret=null,this._stateParam=null,this._authCode=null,this._token=null,this._tokenKey=null,this._tokenKid=null,this._error=null,this._appHash=null,this._loaded=null,this.setCredentials(t)}return t.prototype.setCredentials=function(t){if(t.key)this._id=t.key;else{if(!t.token)throw new Error("No API key supplied");this._id=null}return this._secret=t.secret||null,this._appHash=null,this._error=null,this._loaded=!0,this.reset(),t.token?(this._token=t.token,t.tokenKey&&(this._tokenKey=t.tokenKey,this._tokenKid=t.tokenKid)):t.oauthCode?this._authCode=t.oauthCode:t.oauthStateParam&&(this._stateParam=t.oauthStateParam),this},t.prototype.credentials=function(){var t;return t={},this._id&&(t.key=this._id),this._secret&&(t.secret=this._secret),null!==this._token?(t.token=this._token,this._tokenKey&&(t.tokenKey=this._tokenKey,t.tokenKid=this._tokenKid)):null!==this._authCode?t.oauthCode=this._authCode:null!==this._stateParam&&(t.oauthStateParam=this._stateParam),t},t.prototype.step=function(){return null!==this._token?h.Client.DONE:null!==this._authCode?h.Client.AUTHORIZED:null!==this._stateParam?this._loaded?h.Client.PARAM_LOADED:h.Client.PARAM_SET:null!==this._error?h.Client.ERROR:h.Client.RESET},t.prototype.setAuthStateParam=function(t){if(null===this._id)throw new Error("No API key supplied, cannot do authorization");return this.reset(),this._loaded=!1,this._stateParam=t,this},t.prototype.checkAuthStateParam=function(t){return this._stateParam===t&&null!==this._stateParam},t.prototype.authStateParam=function(){return this._stateParam},t.prototype.error=function(){return this._error},t.prototype.processRedirectParams=function(t){var e;if(t.error){if(null===this._id)throw new Error("No API key supplied, cannot process errors");return this.reset(),this._error=new h.AuthError(t),!0}if(t.code){if(null===this._id)throw new Error("No API key supplied, cannot do Authorization Codes");return this.reset(),this._loaded=!1,this._authCode=t.code,!0}if(e=t.token_type){if(e=e.toLowerCase(),"bearer"!==e&&"mac"!==e)throw new Error("Unimplemented token type "+e);if(this.reset(),this._loaded=!1,"mac"===e){if("hmac-sha-1"!==t.mac_algorithm)throw new Error("Unimplemented MAC algorithms "+t.mac_algorithm);this._tokenKey=t.mac_key,this._tokenKid=t.kid}return this._token=t.access_token,!0}return!1},t.prototype.authHeader=function(t,e,r){var n,i;return null===this._token?(i=null===this._secret?h.Util.btoa(this._id+":"):h.Util.btoa(this._id+":"+this._secret),"Basic "+i):null===this._tokenKey?"Bearer "+this._token:(n=this.macParams(t,e,r),"MAC kid="+n.kid+" ts="+n.ts+" "+("access_token="+this._token+" mac="+n.mac))},t.prototype.addAuthParams=function(t,e,r){var n;return null===this._token?(r.client_id=this._id,null!==this._secret&&(r.client_secret=this._secret)):(null!==this._tokenKey&&(n=this.macParams(t,e,r),r.kid=n.kid,r.ts=n.ts,r.mac=n.mac),r.access_token=this._token),r},t.prototype.authorizeUrlParams=function(t,e){var r;if("token"!==t&&"code"!==t)throw new Error("Unimplemented /authorize response type "+t);return r={client_id:this._id,state:this._stateParam,response_type:t},e&&(r.redirect_uri=e),r},t.prototype.accessTokenParams=function(t){var e;return e={grant_type:"authorization_code",code:this._authCode},t&&(e.redirect_uri=t),e},t.queryParamsFromUrl=function(t){var e,r,n,i,o,s,a,u,h,l;if(s=/^[^?#]+(\?([^\#]*))?(\#(.*))?$/.exec(t),!s)return{};for(h=s[2]||"","/"===h.substring(0,1)&&(h=h.substring(1)),e=s[4]||"",r=e.indexOf("?"),-1!==r&&(e=e.substring(r+1)),"/"===e.substring(0,1)&&(e=e.substring(1)),u={},l=h.split("&").concat(e.split("&")),n=0,o=l.length;o>n;n++)i=l[n],a=i.indexOf("="),-1!==a&&(u[decodeURIComponent(i.substring(0,a))]=decodeURIComponent(i.substring(a+1)));return u},t.prototype.macParams=function(t,e,r){var n,i;return n={kid:this._tokenKid,ts:h.Util.Oauth.timestamp()},i=t.toUpperCase()+"&"+h.Util.Xhr.urlEncodeValue(e)+"&"+h.Util.Xhr.urlEncodeValue(h.Util.Xhr.urlEncode(r)),n.mac=h.Util.hmac(i,this._tokenKey),n},t.prototype.appHash=function(){return this._appHash?this._appHash:this._appHash=h.Util.sha1("oauth2-"+this._id).replace(/[\/+=]/g,"")},t.prototype.reset=function(){return this._stateParam=null,this._authCode=null,this._token=null,this._tokenKey=null,this._tokenKid=null,this._error=null,this},t.timestamp=function(){return Math.floor(Date.now()/1e3)},t.randomAuthStateParam=function(){return["oas",Date.now().toString(36),Math.random().toString(36)].join("_")},t}(),null==Date.now&&(h.Util.Oauth.timestamp=function(){return Math.floor((new Date).getTime()/1e3)}),2274814865e3===new Date("Fri, 31 Jan 2042 21:01:05 +0000").valueOf()?h.Util.parseDate=function(t){return new Date(t)}:2274814865e3===Date.parse("Fri, 31 Jan 2042 21:01:05 +0000")?h.Util.parseDate=function(t){return new Date(Date.parse(t))}:!function(){var t,e;return e=/^\w+\, (\d+) (\w+) (\d+) (\d+)\:(\d+)\:(\d+) (\+\d+|UTC|GMT)$/,t={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},h.Util.parseDate=function(r){var n;return(n=e.exec(r))?new Date(Date.UTC(parseInt(n[3]),t[n[2]],parseInt(n[1]),parseInt(n[4]),parseInt(n[5]),parseInt(n[6]),0)):NaN}}(),h.Env.global.XMLHttpRequest&&(!h.Env.global.XDomainRequest||"withCredentials"in new XMLHttpRequest?(s=XMLHttpRequest,o=!1,n="undefined"!=typeof FormData&&-1===navigator.userAgent.indexOf("Firefox")):(s=XDomainRequest,o=!0,n=!1),i=!0),h.Env.global.Uint8Array)if(Object.getPrototypeOf?r=Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array(0))).constructor:Object.__proto__&&(r=new Uint8Array(0).__proto__.__proto__.constructor),h.Env.global.Blob){try{!function(){return 2===new Blob([new Uint8Array(2)]).size?(u=!0,a=!0):(a=!1,u=2===new Blob([new ArrayBuffer(2)]).size)}()}catch(d){a=!1,u=!1,h.Env.global.WebKitBlobBuilder&&-1!==navigator.userAgent.indexOf("Android")&&(n=!1)}r===Object&&(a=!1)}else u=!1,a=!0;else r=null,u=!1,a=!1;h.Util.Xhr=function(){function t(t,e){this.method=t,this.isGet="GET"===this.method,this.url=e,this.wantHeaders=!1,this.headers={},this.params=null,this.body=null,this.preflight=!(this.isGet||"POST"===this.method),this.signed=!1,this.completed=!1,this.responseType=null,this.callback=null,this.xhr=null,this.onError=null}return t.Request=s,t.ieXdr=o,t.canSendForms=n,t.doesPreflight=i,t.ArrayBufferView=r,t.sendArrayBufferView=a,t.wrapBlob=u,t.prototype.xhr=null,t.prototype.onError=null,t.prototype.setParams=function(t){if(this.signed)throw new Error("setParams called after addOauthParams or addOauthHeader");if(this.params)throw new Error("setParams cannot be called twice");return this.params=t,this},t.prototype.setCallback=function(t){return this.callback=t,this},t.prototype.signWithOauth=function(t,e){return h.Util.Xhr.ieXdr?this.addOauthParams(t):this.preflight||!h.Util.Xhr.doesPreflight?this.addOauthHeader(t):this.isGet&&e?this.addOauthHeader(t):this.addOauthParams(t)},t.prototype.addOauthParams=function(t){if(this.signed)throw new Error("Request already has an OAuth signature");return this.params||(this.params={}),t.addAuthParams(this.method,this.url,this.params),this.signed=!0,this},t.prototype.addOauthHeader=function(t){if(this.signed)throw new Error("Request already has an OAuth signature");return this.params||(this.params={}),this.signed=!0,this.setHeader("Authorization",t.authHeader(this.method,this.url,this.params))},t.prototype.setBody=function(t){if(this.isGet)throw new Error("setBody cannot be called on GET requests");if(null!==this.body)throw new Error("Request already has a body");return"string"==typeof t||"undefined"!=typeof FormData&&t instanceof FormData||(this.headers["Content-Type"]="application/octet-stream",this.preflight=!0),this.body=t,this},t.prototype.setResponseType=function(t){return this.responseType=t,this},t.prototype.setHeader=function(t,e){var r;if(this.headers[t])throw r=this.headers[t],new Error("HTTP header "+t+" already set to "+r);if("Content-Type"===t)throw new Error("Content-Type is automatically computed based on setBody");return this.preflight=!0,this.headers[t]=e,this},t.prototype.reportResponseHeaders=function(){return this.wantHeaders=!0},t.prototype.setFileField=function(t,e,r,n){var i,o,s,a,u,l;if(null!==this.body)throw new Error("Request already has a body");if(this.isGet)throw new Error("setFileField cannot be called on GET requests");if("object"==typeof r){"undefined"!=typeof ArrayBuffer&&(r instanceof ArrayBuffer?h.Util.Xhr.sendArrayBufferView&&(r=new Uint8Array(r)):!h.Util.Xhr.sendArrayBufferView&&0===r.byteOffset&&r.buffer instanceof ArrayBuffer&&(r=r.buffer)),n||(n="application/octet-stream");try{r=new Blob([r],{type:n})}catch(u){o=u,window.WebKitBlobBuilder&&(a=new WebKitBlobBuilder,a.append(r),(i=a.getBlob(n))&&(r=i))}"undefined"!=typeof File&&r instanceof File&&(r=new Blob([r],{type:r.type})),l=r instanceof Blob}else l=!1;return l?(this.body=new FormData,this.body.append(t,r,e)):(n||(n="application/octet-stream"),s=this.multipartBoundary(),this.headers["Content-Type"]="multipart/form-data; boundary="+s,this.body=["--",s,"\r\n",'Content-Disposition: form-data; name="',t,'"; filename="',e,'"\r\n',"Content-Type: ",n,"\r\n","Content-Transfer-Encoding: binary\r\n\r\n",r,"\r\n","--",s,"--","\r\n"].join(""))},t.prototype.multipartBoundary=function(){return[Date.now().toString(36),Math.random().toString(36)].join("----")},t.prototype.paramsToUrl=function(){var t;return this.params&&(t=h.Util.Xhr.urlEncode(this.params),0!==t.length&&(this.url=[this.url,"?",t].join("")),this.params=null),this},t.prototype.paramsToBody=function(){if(this.params){if(null!==this.body)throw new Error("Request already has a body");if(this.isGet)throw new Error("paramsToBody cannot be called on GET requests");this.headers["Content-Type"]="application/x-www-form-urlencoded",this.body=h.Util.Xhr.urlEncode(this.params),this.params=null}return this},t.prototype.prepare=function(){var t,e,r,n;if(e=h.Util.Xhr.ieXdr,this.isGet||null!==this.body||e?(this.paramsToUrl(),null!==this.body&&"string"==typeof this.body&&(this.headers["Content-Type"]="text/plain; charset=utf8")):this.paramsToBody(),this.xhr=new h.Util.Xhr.Request,e?(this.xhr.onload=function(t){return function(){return t.onXdrLoad()}}(this),this.xhr.onerror=function(t){return function(){return t.onXdrError()}}(this),this.xhr.ontimeout=function(t){return function(){return t.onXdrError()}}(this),this.xhr.onprogress=function(){}):this.xhr.onreadystatechange=function(t){return function(){return t.onReadyStateChange()}}(this),this.xhr.open(this.method,this.url,!0),!e){r=this.headers;for(t in r)l.call(r,t)&&(n=r[t],this.xhr.setRequestHeader(t,n))}return this.responseType&&("b"===this.responseType?this.xhr.overrideMimeType&&this.xhr.overrideMimeType("text/plain; charset=x-user-defined"):this.xhr.responseType=this.responseType),this},t.prototype.send=function(t){var e,r,n;if(this.callback=t||this.callback,null!==this.body){e=this.body,h.Util.Xhr.sendArrayBufferView?e instanceof ArrayBuffer&&(e=new Uint8Array(e)):0===e.byteOffset&&e.buffer instanceof ArrayBuffer&&(e=e.buffer);try{this.xhr.send(e)}catch(r){if(n=r,h.Util.Xhr.sendArrayBufferView||!h.Util.Xhr.wrapBlob)throw n;e=new Blob([e],{type:"application/octet-stream"}),this.xhr.send(e)}}else this.xhr.send();return this},t.urlEncode=function(t){var e,r,n;e=[];for(r in t)n=t[r],e.push(this.urlEncodeValue(r)+"="+this.urlEncodeValue(n));return e.sort().join("&")},t.urlEncodeValue=function(t){return encodeURIComponent(t.toString()).replace(/\!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")},t.urlDecode=function(t){var e,r,n,i,o,s;for(o={},i=t.split("&"),e=0,n=i.length;n>e;e++)s=i[e],r=s.split("="),o[decodeURIComponent(r[0])]=decodeURIComponent(r[1]);return o},t.prototype.onReadyStateChange=function(){var t,e,r,n,i,o,s,a,u,l,p,c,d,f,_,y,v;if(4!==this.xhr.readyState)return!0;if(this.completed)return!0;if(this.completed=!0,this.xhr.status<200||this.xhr.status>=300)return e=new h.ApiError(this.xhr,this.method,this.url),this.onError?this.onError(e,this.callback):this.callback(e),!0;if(this.wantHeaders?(t=this.xhr.getAllResponseHeaders(),u=t?h.Util.Xhr.parseResponseHeaders(t):this.guessResponseHeaders(),f=u["x-dropbox-metadata"]):(u=void 0,f=this.xhr.getResponseHeader("x-dropbox-metadata")),null!=f?f.length:void 0)try{d=JSON.parse(f)}catch(s){if(p=s,o=f.search(/\}\,\s*\{/),-1!==o)try{f=f.substring(0,o+1),d=JSON.parse(f)}catch(a){p=a,d=void 0}else d=void 0}else d=void 0;if(this.responseType){if("b"===this.responseType){for(i=null!=this.xhr.responseText?this.xhr.responseText:this.xhr.response,r=[],l=c=0,y=i.length;y>=0?y>c:c>y;l=y>=0?++c:--c)r.push(String.fromCharCode(255&i.charCodeAt(l)));v=r.join(""),this.callback(null,v,d,u)}else this.callback(null,this.xhr.response,d,u);return!0}switch(v=null!=this.xhr.responseText?this.xhr.responseText:this.xhr.response,n=this.xhr.getResponseHeader("Content-Type"),n&&(_=n.indexOf(";"),-1!==_&&(n=n.substring(0,_))),n){case"application/x-www-form-urlencoded":this.callback(null,h.Util.Xhr.urlDecode(v),d,u);break;case"application/json":case"text/javascript":this.callback(null,JSON.parse(v),d,u);break;default:this.callback(null,v,d,u)}return!0},t.parseResponseHeaders=function(t){var e,r,n,i,o,s,a,u;for(n={},r=t.split("\n"),i=0,o=r.length;o>i;i++)s=r[i],e=s.indexOf(":"),a=s.substring(0,e).trim().toLowerCase(),u=s.substring(e+1).trim(),n[a]=u;return n},t.prototype.guessResponseHeaders=function(){var t,e,r,n,i,o;for(t={},i=["cache-control","content-language","content-range","content-type","expires","last-modified","pragma","x-dropbox-metadata"],e=0,r=i.length;r>e;e++)n=i[e],o=this.xhr.getResponseHeader(n),o&&(t[n]=o);return t},t.prototype.onXdrLoad=function(){var t,e,r;if(this.completed)return!0;if(this.completed=!0,r=this.xhr.responseText,t=this.wantHeaders?{"content-type":this.xhr.contentType}:void 0,e=void 0,this.responseType)return this.callback(null,r,e,t),!0;switch(this.xhr.contentType){case"application/x-www-form-urlencoded":this.callback(null,h.Util.Xhr.urlDecode(r),e,t);break;case"application/json":case"text/javascript":this.callback(null,JSON.parse(r),e,t);break;default:this.callback(null,r,e,t)}return!0},t.prototype.onXdrError=function(){var t;return this.completed?!0:(this.completed=!0,t=new h.ApiError(this.xhr,this.method,this.url),this.onError?this.onError(t,this.callback):this.callback(t),!0)},t}()}).call(this);
//# sourceMappingURL=dropbox.min.map